function dhtmlXContextMenuObject(c,a,b,d){this.menu=new dhtmlXMenuBarObject(document.body,c,a,"",1,b,d);this.menu.setMenuMode("popup");this.menu.hideBar();this.menu.contextMenu=this;this.menu.enableWindowOpenMode(false);this.menu.setOnClickHandler(this._innerOnClick);this.aframes=new Array();this.registerFrame(window);this.tree=null;return this}dhtmlXContextMenuObject.prototype.registerFrame=function(a){this.aframes[this.aframes.length]=a};dhtmlXContextMenuObject.prototype.setContextMenuHandler=function(func){if(typeof(func)=="function"){this.onClickHandler=func}else{this.onClickHandler=eval(func)}};dhtmlXContextMenuObject.prototype.openAt=function(a,g,e,c){this.espc=convertStringToBoolean(c);var b=new Object;b.button=2;b.clientX=a;b.clientY=g;var d=new Object;d.contextMenuId=e;d.contextMenu=this;d.a=this._contextStart;d.a(document.body,b);this.espc=null};dhtmlXContextMenuObject.prototype.disableMenu=function(a){this._dsbd=convertStringToBoolean(a)};dhtmlXContextMenuObject.prototype.setOnShowMenuHandler=function(func){if(typeof(func)=="function"){this.onShowHandler=func}else{this.onShowHandler=eval(func)}};dhtmlXContextMenuObject.prototype.setContextMenuPosition=function(b,a){this._msTop=parseInt(a);this._msLeft=parseInt(b)};dhtmlXContextMenuObject.prototype._innerOnClick=function(b){var a=document.body.contextMenu;if(a.contextZone.ownerDocument.body.onclick){a.contextZone.ownerDocument.body.onclick()}if(a.onClickHandler){return a.onClickHandler(b,a.zoneId,a.contextZone,a.tree)}return true};dhtmlXContextMenuObject.prototype.setContextZone=function(b,a){if(typeof(b)!="object"){b=document.getElementById(b)}if(!b.contextMenu){b.contextOnclick=b.onmouseup}b.selfobj=this;b.onmouseup=function(c){this.selfobj._contextStart(this,c)};b.contextMenu=this;b.contextMenuId=a};dhtmlXContextMenuObject.prototype._contextStart=function(h,k){if((_isIE)&&(window.event)){event.srcElement.oncontextmenu=function(){event.cancelBubble=true;return false}}if(!this.contextMenu){this.contextMenu=this}var j=h.ownerDocument.parentWindow;if(!j){j=h.ownerDocument.defaultView}if(!k){k=j.event}if(document.body.onclick){document.body.onclick()}if((!k)||(k.button!=2)){if(h.contextOnclick){h.contextOnclick()}return true}else{if(this.contextMenu._dsbd){return true}if(this.contextMenu.onShowHandler){var m=this.contextMenu.onShowHandler(h.contextMenuId);if((typeof(m)=="boolean")&&(!m)){return}}this.contextMenu.menu.showBar()}var o=this.contextMenu.menu.topNod;var f=window.screenTop;if((!f)&&(f!=0)){f=window.screenY+window.outerHeight-window.innerHeight}var b=window.screenLeft;if((!b)&&(b!=0)){b=window.screenX+window.outerWidth-window.innerWidth-4}var d=window.document.documentElement;var c=window.document.body;if(k.screenY-f+o.offsetHeight-(d.scrollTop||c.scrollTop)>(d.clientHeight||c.clientHeight)){var l=o.offsetHeight}else{var l=((this.contextMenu._msTop*(-1))||0)}var n=new Array((d.scrollLeft||c.scrollLeft)+(this.contextMenu._msLeft||0),l-(d.scrollTop||c.scrollTop));o.style.position="absolute";if((!k.screenY)&&(k.clientX)){o.style.top=k.clientY+"px";o.style.left=k.clientX+"px"}else{o.style.top=k.screenY-f-n[1]+"px";o.style.left=k.screenX-b+n[0]+"px"}if(!_isIE){o.style.top=k.clientY-n[1]+"px";o.style.left=k.clientX+n[0]+"px"}this.contextMenu._fixMenuPosition(o);if(o.ieFix){o.ieFix.style.top=o.style.top;o.ieFix.style.left=o.style.left}j.document.body.oncontextmenu=new Function("document.body.oncontextmenu=new Function('if(document.body.onclick)document.body.onclick();return false;');return false;");for(var g=0;g<this.contextMenu.aframes.length;g++){if(this.contextMenu.aframes[g].document){this.contextMenu.aframes[g].document.body.selfobj=this}this.contextMenu.aframes[g].document.body.onclick=function(a){this.selfobj.contextMenu._contextEnd(a)}}document.body.contextMenu=this.contextMenu;this.contextMenu.contextZone=h;this.contextMenu.zoneId=h.contextMenuId;return false};dhtmlXContextMenuObject.prototype._fixMenuPosition=function(a,e){var b=document.body.offsetWidth+document.body.scrollLeft;var c=document.body.offsetHeight-15+document.body.scrollTop;if((a.offsetWidth+parseInt(a.style.left))>b){var d=parseInt(a.style.left)-a.offsetWidth;if((d<0)||(this.espc)){d=b-a.offsetWidth}if(d<0){d=0}a.style.left=d+"px";if(a.ieFix){a.ieFix.style.left=d+"px"}}if((a.offsetHeight+parseInt(a.style.top))>c){var d=parseInt(a.style.top)-a.offsetHeight;if((d<0)||(this.espc)){d=c-a.offsetHeight}if(d<0){d=0}a.style.top=d+"px";if(a.ieFix){a.ieFix.style.top=d+"px"}}if(!e){this._fixMenuPosition(a,1)}};dhtmlXContextMenuObject.prototype._contextEnd=function(b){var c=this.menu;c._closePanel(c);c.lastOpenedPanel="";c.lastSelectedItem=0;c.hideBar();for(var a=0;a<this.aframes.length;a++){if(this.aframes[a].document){this.aframes[a].document.body.onclick=null;this.aframes[a].document.body.oncontextmenu=null}}return false};
